---
title: '`dplyr`: The Yotabites Demo'
author: "Shiv Sundar"
date: "June 5, 2018"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
worldCountries <- read.csv("worldCountries.csv")
library(dplyr)
knitr::opts_chunk$set(echo = TRUE)
```

#Introduction
This tutorial was created to inform the user about every function provided by the `dplyr` package. Commonly used and simple functions will include a short use case and demo. 

##The pipe operator
One of the most used tools provided by `dplyr` is the pipe (`%>%`) operator. We can use it to chain together multiple functions. It's kind of like saying: do this, **then** do this, **then** do this. We'll cover the use and syntax for it as we go.

##Commonly used `dplyr` functions

###Are these two data frames the same?
The `all_equal()` function is used to compare two data frames. One can use this function to check for equality without considering row order, column order, or both.

####Usage
`all_equal(df1, df2, ignore_col_order = TRUE, ignore_row_order = TRUE, convert = FALSE, ...)`

####Parameters
* `df1`, `df2`: dataframes to compare.
* `ignore_col_order`: should the ordering of columns be ignored?
* `ignore_row_order`: should the ordering of rows be ignored?
* `convert`: should the function attempt to coerce factors to characters and integers to doubles?
* `...`: **not used**. required to comply with `all.equal()` usage.

####Examples
```{r include=FALSE}
worldCountries1 <- sample_n(worldCountries[ , c("Country", "Population", "Phones..per.1000.", "Region")], 15)
worldCountriesMix <- worldCountries1[sample(nrow(worldCountries1)), sample(ncol(worldCountries1))]
```

Here we see what the data looks like.
```{r}
head(worldCountries1)
head(worldCountriesMix)
```

Here we test different variations of the function.
```{r}
all_equal(worldCountries1, worldCountriesMix)
all_equal(worldCountries1, worldCountriesMix, TRUE, FALSE)
all_equal(worldCountries1, worldCountriesMix, FALSE, FALSE)
```

###I want to sort my data by a specified order!
Data can be sorted by using the `arrange()` function. It sorts using by using the natural order of the data type. Factors are normally sorted by alphabetical order. To order them differently, please use the `levels()` function.

####Usage
`arrange(.data, ...)`

####Parameters
* `.data`: the dataframe to arrange
* `...`: the columns to sort by

####Examples
```{r}
head(arrange(worldCountries1, Population))
head(worldCountries1 %>%
  arrange(Phones..per.1000.))
```

We just saw the first use of the pipe operator! In English, we took the data frame `worldCountries1`, **then** arranged its data by the values in the `Phones..per.1000.` column. We can accomplish this task without using the pipe operator as well.

```{r}
head(arrange(worldCountries1, Phones..per.1000.))
```

Functions provided by `dplyr` support both options that we just covered. It's up to your preference. However, in this demo we will use the pipe operator to familiarize you with its use.

###Which values in a vector fall between 10.4 and 73?
How can we answer this question? Well, `dplyr` actually provides us with a function called `between()`. That's convenient! 

####Usage
`between(vector, min, max)`

####Parameters
* `vector`: the values to check
* `min`: the minimum value (inclusive)
* `max`: the maximum value (inclusive)

####Examples
```{r}
newData <- sample_n(worldCountriesMix, 15)$Population
head(newData)
newData%>%
  between(200000, 7500000)
```

###Getting rid of NAs and replacing them with values in a vector
The `coalesce()` function takes multiple vectors and combines places the first non-NA value in the returned vector.

####Usage
`coalesce(firstVect, ...)`

####Parameters
* `firstVect`: the base vector. One can take this to be the vector that will be returned with its NA values filled if possible
* `...`: any vector that is of length 1 or equal to the length of `firstVect`

####Usage
```{r}
x <- c(1, 6, NA, 3, NA, 4, 2, NA, 5)
y <- c(NA, 2, 5, NA, 3, NA, 6, 4, 1)
coalesce(x, y)
coalesce(y, x)
```

###`arrange()`, but backwards!
`desc()` is a function that is pretty straightforward. It takes every value in the vector and flips the sign. When this function is used in conjunction with `arrange()`, the vector returned is sorted in reverse order.

####Usage
`desc(vec)`

####Parameters
* `vec`: a vector to reverse the signage of each element

####Examples
```{r}
head(worldCountries1$Phones..per.1000.)
desc(worldCountries1$Phones..per.1000.) %>%
  head
```

###Ew! I have replicated data in my table!
A tool provided by `dplyr` that is frequently used for removing duplicate values is the `distinct()` function. It returns a vector with the duplicates removed

####Usage
`distinct(.data, ..., .keep_all = FALSE)`

####Parameters
* `.data`: the tibble to remove values from (at least one is required)
* `...`: other variables to check for uniqueness
* `.keep_all`: should all variables in `.data` be kept?

####Usage
```{r}
worldCountriesTbl <- as_tibble(worldCountries)
worldCountriesTbl %>%
  distinct(Coastline..coast.area.ratio.) %>%
  head
```

###I'm having issues with my `dplyr` installation! What do I do?
`dr_dplyr()` is a maintenance tool provided by `dplyr` to diagnose common problems with the package itself. This function can sometimes show false errors, so only use it if there are problems.

####Usage
`dr_dplyr()`

####Parameters
**N/A**

####Examples
```{r}
dr_dplyr()
```


###I need a more readable description of my tibble.
`explain()` is a function that is similar to `print()` and `str()` but is more focused on human readability while still providing more details about the data.

####Usage
`explain(.data)`

####Parameters
* `.data`: data that needs explaining

####Examples
```{r}
#need to fix this
#explain(worldCountriesTbl)
```

###Is there an easy way to find elements that fit a certain condition?
Well, of course there is! It's called the `filter()` function. It is different from using subsets (like `[]`) because it does not return `NA` values.

####Usage
`filter(.data, ...)`

####Parameters
* `.data`: data to pass through the filter
* `...`: 

####Examples
```{r}
head((worldCountries %>%
  filter(between(GDP....per.capita., 2000, 5000)))[1])
```

###Grouping multiple rows together for batch operations


####Usage


####Parameters


####Examples


###


####Usage


####Parameters


####Examples


##Datasets provided by `dplyr`
These datasets are bundled with the `dplyr` package for testing and manipulating.

* `band_members`
* `band_instruments`
* `band_instruments2`
* `nasa`
* `starwars`
* `storms`

##Other functions not covered

all_vars
arrange_all
as.table.tbl_cube
as.tbl_cube
auto_copy
bind
case_when
compute
copy_to
cumall
do
filter_all
funs
groups
group_by
group_by_all
ident
if_else
join
join.tbl_df
lead-lag
mutate
n
na_if
near
nth
n_distinct
order_by
pull
ranking
recode
rowwise
sample
scoped
select
select_all
select_vars
setops
slice
sql
src_dbi
summarise
summarise_all
tally
tbl
tbl_cube
top_n
vars